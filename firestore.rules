rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is admin
    function isAdmin() {
      return request.auth != null && request.auth.token.email != null;
      // TODO: Uncomment and add your admin emails below for production:
      // return request.auth != null && request.auth.token.email in [
      //   'youradmin@example.com',
      //   'anotheradmin@yourdomain.org'
      // ];
    }

    // Publicly readable site data: events, reflections, gallery index
    match /site-data/{doc} {
      allow read: if true; // anyone can read
      allow write: if isAdmin(); // only authenticated admins can write
    }

    // Site settings (homepage background, etc.)
    match /site-settings/{setting} {
      allow read: if true; // anyone can read settings
      allow write: if isAdmin(); // only authenticated admins can write
    }

    // Audit logs - admins can write, only authenticated users can read their own logs
    match /audit-logs/{logId} {
      allow read: if request.auth != null;
      allow create: if isAdmin() && request.resource.data.userId == request.auth.uid;
      allow update, delete: if false; // logs are immutable
    }

    // Admin activity tracking - for monitoring who's logged in
    match /admin-sessions/{sessionId} {
      allow read: if isAdmin();
      allow create, update: if isAdmin() && request.resource.data.userId == request.auth.uid;
      allow delete: if isAdmin();
    }
  }
}


